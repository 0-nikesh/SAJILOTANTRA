{% load static %}
<!DOCTYPE html>
<html lang="en">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <head>
    <title>{{ GovernmentProfile.name }}</title>
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/c30dadd52a.js" crossorigin="anonymous"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css"  rel="stylesheet" />
		<script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
        <script src="https://kit.fontawesome.com/c30dadd52a.js" crossorigin="anonymous"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css"  rel="stylesheet" />
        <script src="https://unpkg.com/@trevoreyre/autocomplete-js"></script>


    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap"
        rel="stylesheet">
		<link rel="stylesheet" href="static\css\dashboard.css">
		<script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>

  </head>

  <body class="bg-blue-50">
    <header class="">
        <nav class="fixed bg-white shadow flex justify-between items-center w-[100%]  mx-auto">
            <div>
            <a href="/dashboard#">  <img style="width:17rem;" src="\static\assets\LogoWhite.png" alt="..."></a>
            </div>
            <div class="nav-links duration-500 md:static absolute bg-white md:min-h-fit min-h-[60vh] left-0 top-[-100%] md:w-auto  w-full flex items-center px-5">
            <ul class="flex md:flex-row flex-col md:items-center md:gap-[4vw] gap-8">
            <li>
                <li>
					<a class="" href="#">
						<div class="text-xl bg-red-800 text-white w-10 h-10 flex justify-center items-center rounded-lg mx-auto hover:bg-blue-800">
							<i class="fa-solid fa-house"></i>
						</div>
					</a>
				</li>
				<li>
					<a class="" href="/events">
						<div class="text-xl bg-white text-gray-500 w-10 h-10 flex justify-center items-center rounded-lg mx-auto hover:bg-blue-800 hover:text-white">
							<i class="fa-regular fa-calendar-days"></i>
						</div>
					</a>
				</li>
				<li>
					<a class="" href="/government_profiles">
						<div class="text-xl bg-white text-gray-500 w-10 h-10 flex justify-center items-center rounded-lg mx-auto hover:bg-blue-800 hover:text-white">
							<i class="fa fa-building-o"></i>
						</div>
					</a>                   
				 </li>
				<li>
					<a class="" href="/map/">
						<div class="text-xl bg-white text-gray-500 w-10 h-10 flex justify-center items-center rounded-lg mx-auto hover:bg-blue-800 hover:text-white">
							<i class="fa-solid fa-map-location-dot"></i>                            </div>
					</a>                   
				</li>
                    <li>
                        <form class="flex items-center">
                            <label for="simple-search" class="sr-only">Search</label>
                            <div class="relative w-full">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg aria-hidden="true" class="w-5 h-5 text-[#858EAD]" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                                <div id="autocomplete" class="autocomplete relative">
                                    <input 
                                        id="searchInput"
                                        class="autocomplete-input block w-full p-2.5 pl-10 pr-10 text-sm text-gray-700 rounded-lg border border-gray-300 focus:ring-primary-100 focus:border-primary-100 transition-all duration-300 ease-in-out" 
                                        placeholder="Type here to search..." 
                                        required 
                                        oninput="toggleSearchIcon()"
                                        onkeydown="handleSearchKeyPress(event)"
                                    />
                                    <span id="searchIcon" class="absolute inset-y-0 right-3 top-2.5 text-gray-500">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    
                                    <ul class="autocomplete-result-list bg-white border border-gray-300 rounded-lg shadow-md mt-1 overflow-hidden">
                                        
                                    </ul>
                                    <script>
                                        function toggleSearchIcon() {
                                            const input = document.getElementById('searchInput');
                                            const icon = document.getElementById('searchIcon');
        
                                            if (input.value.trim() !== '') {
                                                icon.style.display = 'none';
                                            } else {
                                                icon.style.display = 'block';
                                            }
                                        }
        
                                        function handleSearchKeyPress(event) {
                                            if (event.key === 'Enter') {
                                                const input = document.getElementById('searchInput');
                                                const username = input.value.trim();
        
                                                if (username !== '') {
                                                    // Make an Ajax request to the Django view
                                                    fetch(`/view_profile/${encodeURIComponent(username)}/`)
                                                        .then(response => {
                                                            if (response.ok) {
                                                                // Redirect to the user profile page
                                                                window.location.href = response.url;
                                                            } else {
                                                                // Handle errors if needed
                                                                console.error('Failed to fetch user profile');
                                                            }
                                                        })
                                                        .catch(error => console.error(error));
                                                }
                                            }
                                        }
                                    </script>
        
                                </div>
                        </form>
    
                    </li>
                </ul>
            </div>
            <div class="flex items-center gap-6">
                {% comment %} <button class="bg-[#043172] text-white px-5 py-2 rounded-full hover:bg-[#10223B]">Sign in</button> {% endcomment %}
                
                <button id="notificationButton" type="button" data-dropdown-toggle="notification-dropdown" class="p-2 mr-1 text-gray-500 rounded-lg hover:text-gray-900 hover:bg-blue-800 hover:text-white dark:text-gray-400 dark:hover:text-white dark:hover:bg-blue-800 focus:ring-4 focus:ring-blue-800 dark:focus:ring-blue-800">
                    <span class="sr-only">View notifications</span>
                    <!-- Bell icon -->
                    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20"><path d="M12.133 10.632v-1.8A5.406 5.406 0 0 0 7.979 3.57.946.946 0 0 0 8 3.464V1.1a1 1 0 0 0-2 0v2.364a.946.946 0 0 0 .021.106 5.406 5.406 0 0 0-4.154 5.262v1.8C1.867 13.018 0 13.614 0 14.807 0 15.4 0 16 .538 16h12.924C14 16 14 15.4 14 14.807c0-1.193-1.867-1.789-1.867-4.175ZM3.823 17a3.453 3.453 0 0 0 6.354 0H3.823Z"/></svg>
                </button>
    
                {% comment %} Notifications {% endcomment %}
                 <!-- Dropdown menu -->
                {% comment %} Profile Secion {% endcomment %}
                <div id="profileContainer" class="flex items-center gap-3 cursor-pointer mx-2 rounded-full focus:ring-2 hover:ring-2 hover:ring-gray-600 focus:ring-gray-800 ">
                    <img class="w-10 h-10 rounded-full" src="https://placekitten.com/40/40" alt="Profile Picture">
                </div>
                <div id="profileDropdown"
                    class="hidden origin-top-right absolute right-2 top-14 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                    <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="profileContainer">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                            role="menuitem">Profile Settings</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                            role="menuitem">Logout</a>
                    </div>
                </div>
                {% comment %} Hamburger {% endcomment %}
                <ion-icon onclick="onToggleMenu(this)" name="menu" class="text-3xl cursor-pointer md:hidden"></ion-icon>
            </div>
    </header>
    <div>
        safe
    </div>
    <section>
        <div class="rounded-lg shadow-xl w-11/12 mx-auto bg-white pt-10 pb-2 px-6" style="margin-top: 70px; margin-bottom: 70px;">
            <div style="font-size: 20px; font-weight: bold; margin-bottom: 10px; text-align: center;">
            {{ GovernmentProfile.name }}
          </div>
          <div class="py-4 px-6">
            {{GovernmentProfile.description | safe}}
          </div>
          
        </div>     
    
        </section>

    <section class="text-gray-600 mt-6 body-font overflow-hidden text-center">
      <h1 class="text-gray-900 text-3xl title-font font-medium mb-1">Explore On A Map</h1>
    </section>

    <div id="map" class="mt-3 p-7 border border-gray-300" style="height: 400px;"></div> 

    <section class="text-gray-600 body-font overflow-hidden">
      <div class="container px-5 py-24 mx-auto">
        <div class="lg:w-4/5 mx-auto flex flex-wrap">
          <img alt="thumbnail" class="lg:w-1/2 w-full lg:h-auto h-64 object-cover object-center rounded" src="{{ GovernmentProfile.thumbnail.url }}">
          <div class="lg:w-1/2 w-full lg:pl-10 lg:py-6 mt-6 lg:mt-0">
            <h1 class="text-gray-900 text-3xl title-font font-medium mb-1">{{ GovernmentProfile.name }}</h1>
            <div class="flex mb-4">
            </div>
            <p class="leading-relaxed">{{ GovernmentProfile.description|safe }}.</p>
            <div class="flex mt-6 items-center pb-5 border-b-2 border-gray-100 mb-5">
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="text-gray-600 body-font overflow-hidden text-center">
      <h1 class="text-gray-900 text-3xl title-font font-medium mb-1">Explore On A Map</h1>
    </section>

    <div id="map" class="mt-8 p-7 border border-gray-300" style="height: 400px; "></div> 

      <!-- <h2 class="title">{{ GovernmentProfile.name }}</h2>

      <div class="content">{{ GovernmentProfile.description|safe }}</div>

      <div class="content">{{ GovernmentProfile.address|safe }}</div>

      <img src="{{ GovernmentProfile.thumbnail.url }}" alt="Your Name" width="30" height="30" style="border-radius: 50%; vertical-align: middle;" />

      <div id="map" style="height: 400px; width: 500px;"></div> -->

      <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

      <script>
          var address = "{{ GovernmentProfile.address }}";
          var coordinates = extractCoordinatesFromAddress(address);

          function extractCoordinatesFromAddress(address) {
              var coords = address.split(',');
              return [parseFloat(coords[0]), parseFloat(coords[1])];
          }

          var map = L.map('map').setView(coordinates, 13);

          L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);

          L.marker(coordinates).addTo(map)
              .bindPopup('{{ GovernmentProfile.name }}')
              .openPopup();
      </script>
      <script>
        function hoverResult(element) {
            element.style.backgroundColor = '#f5f5f5'; // Set your desired hover background color
        }
    
        function unhoverResult(element) {
            element.style.backgroundColor = ''; // Reset to the default background color
        }
    
        function loadValueToSearchInput(value) {
            document.getElementById('searchInput').value = value;
        }
    
        new Autocomplete('#autocomplete', {
            search: input => {
                console.log(input);
    
                if (!input) {
                    return Promise.resolve([]);
                }
    
                const url = `/get-names/?search=${encodeURIComponent(input)}`;
    
                return fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => data.payload)
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        return [];
                    });
            },
            renderResult: (result, props) => {
                console.log(props);
    
                let group = '';
                if (props && props.index % 3 === 0) {
                    group = `<li style="background-color: #f0f0f0; padding: 5px; font-weight: bold; color: #333;">Group</li>`;
                }
    
                if (!result || result.length === 0) {
                    return `${group}<li style="list-style: none; padding: 10px; text-align: center;">No result found</li>`;
                }
    
                // Accessing the username from the props object
                const username = props.username || result.user;
    
                // Adding a hyperlink to the li element
                const profileLink = `/view_profile/${username}/`;
    
                return `
                    ${group}
                    <li style="list-style: none; padding: 10px; border-bottom: 1px solid #ddd; cursor: pointer; transition: background-color 0.3s;" 
                        onclick="loadValueToSearchInput('${username}')"
                        onmouseover="hoverResult(this)"
                        onmouseout="unhoverResult(this)">
                        <a href="${profileLink}" style="text-decoration: none; color: inherit;">
                            <div style="font-size: 16px; color: #007bff;" class="wiki-title">
                                ${username}
                            </div>
                        </a>
                    </li>`;
            }
        });
    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
<script src="static/javascript/dashboard.js"></script>
<script src="static/javascript/fileUpload.js"></script>
  </body>
</html>
